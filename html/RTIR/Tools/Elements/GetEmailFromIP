%# BEGIN LICENSE BLOCK
%# 
%# Copyright (c) 1996-2003 Jesse Vincent <jesse@bestpractical.com>
%# 
%# (Except where explictly superceded by other copyright notices)
%# 
%# This work is made available to you under the terms of Version 2 of
%# the GNU General Public License. A copy of that license should have
%# been provided with this software, but in any event can be snarfed
%# from www.gnu.org
%# 
%# This work is distributed in the hope that it will be useful, but
%# WITHOUT ANY WARRANTY; without even the implied warranty of
%# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
%# General Public License for more details.
%# 
%# 
%# Unless otherwise specified, all modifications, corrections or
%# extensions to this work which alter its source code become the
%# property of Best Practical Solutions, LLC when submitted for
%# inclusion in the work.
%# 
%# 
%# END LICENSE BLOCK
<%INIT>
# $address is passed by reference

# Net::Whois::RIPE does this for its method names
my $orig_field = $field;
$field =~ tr/-/_/;

$$address = loc("ADDRESS_UNKNOWN");

use Net::Whois::RIPE;
my $whois = Net::Whois::RIPE->new( $server, Debug => 1 );
unless ( $whois ) {
    $$error = "Unable to connect to whois server '$server'";
    return;
}

my $query = $whois->query($q);
unless ( $query ) {
    $$error = "Unable to connect to whois server '$server'";
    return;
}
unless ($query->can($field)) {
    $$error = "Whois server response did not include field '$orig_field'";
}

$$address = $query->$field();
</%INIT>

<%ARGS>
$server => undef
$q => undef
$field => "notify"
$address => undef
$error => undef
</%ARGS>
