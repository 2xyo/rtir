<%INIT>

# Set $skip to 1 if transaction matches criteria
# $skip is passed by reference

# skip _RTIR_IP changes done by system user(scrips)
if ( $Transaction->Creator == $RT::SystemUser->id && $Transaction->Type eq 'CustomField' ) {
    my $cf = RT::IR::GetCustomField('_RTIR_IP') or return $$skip = 0;
    return $$skip = 0 unless $cf->id == $Transaction->Field;
    return $$skip = 1;
}

# get out of here asap
unless ( $Transaction->Field eq 'Status' && $Transaction->Type =~ /^(?:Status|Set)$/ ) {
    return $$skip = 0;
}

# check only ticket's transactions
my $obj = $Transaction->Object;
return $$skip = 0 unless $obj && $obj->isa( 'RT::Ticket' );

# only check if it's an RTIR queue
my $Queue = $obj->QueueObj->Name;
return $$skip = 1 if $Queue =~ /^(?:Incidents|Incident Reports|Investigations|Blocks)$/i;

return $$skip = 0;

</%INIT>

<%ARGS>
$skip => undef
$Transaction => undef
</%ARGS>
