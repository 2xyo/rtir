General upgrade instructions
============================

1) Follow specialized upgrade instructions in the sections below

2) Install the new version of RTIR. (DO NOT RUN "make initdb")

3) Update RTIR's database.
    
   Type:

        ls etc/upgrade

    For each item in that directory whose name is greater than
    your previously installed RT version, run:
    
        /opt/rt3/sbin/rt-setup-database --dba <dba> \
            --prompt-for-dba-password --action schema \
            --datadir etc/upgrade/<version>
        /opt/rt3/sbin/rt-setup-database --dba <dba> \
            --prompt-for-dba-password --action insert \
            --datadir etc/upgrade/<version>


Follow instructions from previous "upgrading from" sections at
the end of this document if they apply to your installation.

Upgrading from RTIR 1.1.5
-------------------------

1) NewMessage template in Blocks and LaunchMessage in Investigations
queues were renamed into 'Autoreply', but also content of
the 'NewMessage' template was changed, new content is below. Update
content of the template in Blocks queue manually.
<<<<<<<<<<< start <<<<<<<<<<<<<<<
RT-Attach-Message: yes
Subject: { $Ticket->Subject }

{ $Transaction->Content }

{ my $output = "";
  my @mailfields = qw(
      _RTIR_IP
      _RTIR_Netmask
      _RTIR_Port
      _RTIR_WhereBlocked
  );

  my $CustomFields = $Ticket->QueueObj->TicketCustomFields;
  while ( my $CustomField = $CustomFields->Next ) {
    my $name = $CustomField->Name;
    next unless grep $_ eq $name, @mailfields;

    my $Values = $Ticket->CustomFieldValues( $CustomField->Id );
    while ( my $Value = $Values->Next ) {
      $name =~ /^_RTIR_(.*)/;
      $output .= ($1 || $name) .": "
              .  $Value->Content ."\n";
    }
  }
  return $output;
}
-------------------------------------------------------------------------
Please include the string:

         [{ $rtname } #{ $Ticket->id }]

in the subject line of all future correspondence about this issue. To do so, 
you may reply to this message.

                        Thank you,
                        { $Ticket->QueueObj->CorrespondAddress }
>>>>>>>>>>>  end  >>>>>>>>>>>>>>>

2) Content of the template 'BlockRemoved' was also changed:

<<<<<<<<<< start <<<<<<<<<<<<<<<<
Subject: {$Ticket->Subject}

Block #{$Ticket->id} was removed.

{ my $output = "";
  my @mailfields = qw(
    _RTIR_IP
    _RTIR_Netmask
    _RTIR_Port
    _RTIR_WhereBlocked
  );
  my $CustomFields = $Ticket->QueueObj->TicketCustomFields;
  while ( my $CustomField = $CustomFields->Next ) {
    my $name = $CustomField->Name;
    next unless grep $_ eq $name, @mailfields;

    my $Values = $Ticket->CustomFieldValues( $CustomField->Id );
    while ( my $Value = $Values->Next ) {
      $name =~ /^_RTIR_(.*)/;
      $output .= ($1 || $name) .": "
              .  $Value->Content ."\n";
    }
  }
  return $output;
}
-------------------------------------------------------------------------
Please include the string:

         [{$rtname} #{$Ticket->id}]

in the subject line of all future correspondence about this issue. To do so, 
you may reply to this message.

                        Thank you,
                        {$Ticket->QueueObj->CorrespondAddress()}
>>>>>>>>>>>  end  >>>>>>>>>>>>>>>


Upgrading from RTIR 1.1.3
-------------------------

1) Delete the following Scrips (go to Configuration / Queues / <Queue
Name> / Scrips):

In the Incidents Queue:
  SetStartsDate
  SetRTIRState
  ResolveAllChildren
  FixOwnership

In the Incident Reports Queue:
  DetectUserResponse 
  SetDue             
  SetStarts          
  UnsetDue           
  SetDueReopen       
  SetHowReported     
  SetRTIRState       
  FixOwnership       
  ReopenIncident

In the Investigations Queue:
  NotifyOnLaunch
  DetectUserResponse
  SetStarts
  SetDue
  UnsetDue
  SetDueReopen
  SetRTIRState
  FixOwnership
  ReopenIncident

In the Blocks Queue:
  NotifyOnCreate
  DetectUserResponse
  SetStarts
  SetDue
  UnsetDue
  UnsetDue
  SetDueReopen
  SetRTIRState
  FixOwnership
  ReopenIncident

2) Run the etc/upgrade/upgrade.pl script.

This script updates Due Dates on all incidents and set to the most
recent due date of the children. 

NOTE that script use hardcoded path '/opt/rt3', if your RT server installed
into different location you should change it.


Upgrading from RTIR 1.1.2:
--------------------------

1) Delete the "SetDueReopen" scrip from the Incident Reports,
   Investigations, and Blocks queues.

Upgrading from RTIR 1.0.0:
--------------------------

RTIR now installs in RT's share/html directory rather than local/html,
making local modifications to RTIR easier.

1) IMPORTANT!  Back up any modifications that you've made to the
   /opt/rt3/local/html/RTIR directory.

2) Remove the old RTIR files:

   rm -r /opt/rt3/local/html/RTIR

