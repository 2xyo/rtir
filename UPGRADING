Upgrading from RTIR 1.2.0 or earlier
-------------------------------------

* Best Practical Solutions will provide upgrade support to
RTIR Working Group members upgrading from RTIR 1.2 or older.
Please contact customer-development@bestpractical.com.

General upgrade instructions
============================

0) Make a backup of the database. It's very important.

1) Upgrade to the RT 3.7 following its upgrade instructions.

2) Install or upgrade RTFM.

3) Delete '/opt/rt3/share/html/Callbacks/RTIR'. If you have
   any locally customized components in that directory, you
   should be careful not to delete them during the upgrade.

4) Install the new version of RTIR. (DO NOT RUN "make initdb")

5) Update RTIR's database.

    Type:

        ls etc/upgrade

    For each item in that directory whose name is greater than
    your previously installed RTIR version, run:
    
        /opt/rt3/sbin/rt-setup-database --dba <dba> \
            --prompt-for-dba-password --action schema \
            --datadir etc/upgrade/<version>
        /opt/rt3/sbin/rt-setup-database --dba <dba> \
            --prompt-for-dba-password --action insert \
            --datadir etc/upgrade/<version>

    After each step follow additional instructions below.

    For example if you had RTIR 1.1.1 then you should run
    above commands for etc/upgrade/1.1.3 datadir, check
    instructions under "Applying changes from etc/upgrade/1.1.3"
    section below, then do the same with 1.9.0 dir and greater.

    *Note* that even if there is no etc/upgrade/<some version> dir
    then anyway *you must* read instructions below for all versions
    greater or equal to that you're upgrading from as some upgrades
    may require manual changes or describe important changes in
    the RTIR you should be aware of.

Upgrading from 2.3.15 and earlier
-------------------------

There was an error in the etc/upgrade/upgrade.pl script. It could skip
some incidents during upgrade. Run this script again, especially if you
never did that or ran with earlier versions of the RTIR. This script
updates Due dates on active incidents where it's not set and set to
the most recent due date of the active children.

Applying changes from upgrade/2.3.0
-------------------------

At these step no special actions are required, run the upgrade scripts where we
split out incidents owned by Nobody and the Current User on the most-due views
on the homepage.

Applying changes from upgrade/2.1.1
-------------------------

At these step no special actions are required, run the upgrade
scripts where we add several scrips that set 'Started' date
of tickets in the RTIR.

Applying changes from upgrade/2.1.0
-------------------------

At these step no special actions are required, run the upgrade
scripts where we do following things:

1) Apply the _RTIR_IP CF to all RTIR's queues and convert it to
multiple type. Also, we add several scrips to parse IP addresses
from incomming mails and to fill those into the CF.

2) The constituency field we apply to all RTIR's queues too and
and add several scrips to track values of the field.

Applying changes from upgrade/1.9.0
-------------------------

1) The LaunchMessage template in the Investigations queue
has been renamed into Autoreply without any changes of the content.
This upgrade step is automated, but may fail if you've changed
the LaunchMessage template.

2) In the Blocks queue an Autoreply template has been added. This is
replacement for the NewMessage template. Automated step doesn't delete
old template, you have to check that the new template suites your
needs and may be copy customizations from the old one, then delete
the NewMessage template.

3) The new 'BlockRemoved' template has been added in the Blocks
queue. Check its content.

4) NotifyOnLaunch and NotifyOnCreate scrips have been deleted in
the Implementations and the Blocks queues respectively. You have to
use the default RT's Autoreply scrip instead or create autoreply
scrips in these queues if global one is disabled or doesn't exist.
You need the following scrip in the queues:

  On Create AutoReply to Requestors with Template Autoreply

Applying changes from upgrade/1.1.3
-------------------------

No special steps required, just run upgrade scripts. Everything
is automated. At this step we install several new actions,
conditions and scrips that had been introduced in the RTIR 1.1.3.
Also, we change action of the 'SetDueReopen' scrips.

Applying changes from upgrade/1.1.1
-------------------------

1) At these step we switch from 'UserDefined' actions and conditions
   to modules, so all code would be in the lib directory. If you changed
   the code of the scrips then you have to port changes.

2) Run the etc/upgrade/upgrade.pl script. This script updates Due Dates
   on active incidents where it's not set and set to the most recent due
   date of the active children.

Applying changes from upgrade/1.0.3
-------------------------

No special steps required, just run upgrade scripts. Everything
is automated. At this step we grant the ShowTemplate right to
the DutyTeam group.

Upgrading from RTIR 1.0.0:
--------------------------

RTIR now installs in RT's share/html directory rather than local/html,
making local modifications to RTIR easier.

1) IMPORTANT!  Back up any modifications that you've made to the
   /opt/rt3/local/html/RTIR directory.

2) Remove the old RTIR files:

   rm -r /opt/rt3/local/html/RTIR

